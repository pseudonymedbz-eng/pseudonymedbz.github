<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Steal the Brainrot - Fortnite</title>
<style>
:root{--accent:#00ffff;}
body{
  margin:0;font-family:Arial,Helvetica,sans-serif;
  background-image:url('TON_IMAGE_DE_FOND_URL_ICI');
  background-size:cover;background-position:center;
  color:#fff;
}
.container{background:rgba(6,6,20,0.88);min-height:100vh;padding:24px;box-sizing:border-box;}
h1,h2{color:var(--accent);margin:6px 0;}
.box{background:rgba(20,20,40,0.95);border:2px solid var(--accent);padding:14px;border-radius:10px;margin:12px 0;}
.codes p{margin:6px 0;}
.annonce-banner{display:none;background:#c62828;color:#fff;padding:14px;border-radius:8px;margin-bottom:12px;text-align:center;}
.annonce{background:rgba(255,0,0,0.06);padding:10px;border-left:4px solid red;margin-bottom:10px;border-radius:6px;}
.comment{background:rgba(255,255,255,0.04);padding:10px;border-radius:8px;margin-bottom:8px;}
input,textarea,button{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:0;box-sizing:border-box;}
button{background:var(--accent);color:#000;font-weight:700;cursor:pointer;}
.delete-btn{background:#ff4444;color:#fff;border:0;padding:6px 10px;border-radius:6px;cursor:pointer;margin-left:8px;}
#brainrot-emoji{position:fixed;right:18px;bottom:18px;font-size:34px;padding:8px;border-radius:50%;background:rgba(0,0,0,0.35);cursor:pointer;z-index:9999;}
@media(max-width:600px){.container{padding:12px} h1{font-size:20px}}
</style>
</head>
<body>
<div class="container">
  <h1>Steal the Brainrot - Fortnite</h1>

  <!-- Banni√®re annonce -->
  <div id="annonceBanner" class="annonce-banner">
    <strong id="annTitleBanner"></strong>
    <div id="annMsgBanner"></div>
  </div>

  <!-- Historique annonces -->
  <div id="annoncesHistory" class="box"></div>

  <p>Fortnite ne se limite plus √† son Battle Royale classique. La carte <strong>Steal the Brainrot</strong> rencontre un immense succ√®s. Inspir√©e des modes tycoon, elle repose sur la m√©canique d'accumulation de Brainrots.</p>

  <div class="box">
    <h2>üë• Joueurs en ligne</h2>
    <div id="visitorCount">Chargement...</div>
  </div>

  <div class="box">
    <h2>üíª Comment utiliser les codes ?</h2>
    <p>Allez au terminal num√©rique ou √† c√¥t√© de la roue Galaxy Spin. Tapez le code puis validez.</p>
  </div>

  <div class="box codes">
    <h2>üìú Codes Utilisables</h2>
    <p>(NEW) 651312 ‚Üí Fait appara√Ætre un Ferinsini Luckini</p>
    <p>(NEW) 410592 ‚Üí Brainrot Secret dans la machine d'am√©lioration</p>
    <p>(NEW) 3428 ‚Üí Passe le temps de la machine d'am√©lioration</p>
    <p>536736 ‚Üí Brainrot Secret dans la machine d'am√©lioration</p>
    <p>3851 ‚Üí Passe le temps de la machine d'am√©lioration</p>
    <p>1003 ‚Üí Passe le temps de la machine d'am√©lioration</p>
    <p>1706 ‚Üí D√©bloque un Brainrot God Lucky Rot</p>
    <p>8257 ‚Üí Lucky Rot Brainrot God</p>
    <p>5269 ‚Üí Fait appara√Ætre un Brainrot God</p>
  </div>

  <div class="box codes">
    <h2>üìú Codes Expir√©s</h2>
    <p>526497, 9586, 2553, 7389, 9452, 1442, 9231, 6393, 3632, 3005, 9207676, 2388, 7346, 1825, 1912, 5289, 1507, 0108, 3000, 9547, 6759</p>
    <p>Si un code ne fonctionne plus, c‚Äôest normal ‚Äî il a √©t√© supprim√©.</p>
  </div>

  <div class="box">
    <h2>üó∫Ô∏è √âtat de la map</h2>
    <p>Zone centrale : Terminal num√©rique et roue Galaxy Spin</p>
    <p>Zone Brainrot : Brainrots normaux apparaissent toutes les 5 minutes</p>
    <p>Zone machine d‚Äôam√©lioration : Machine fonctionnelle, peut √™tre acc√©l√©r√©e avec les codes</p>
    <p>Zone Ferinsini Luckini : Zone rare avec Brainrots sp√©ciaux</p>
  </div>

  <div class="box">
    <h2>üí¨ Commentaires des joueurs</h2>
    <div id="commentsList"></div>

    <input id="inputUser" placeholder="Ton pseudo">
    <textarea id="inputMsg" rows="3" placeholder="√âcris si le code X marche (‚úÖ) ou pas (‚ùå)"></textarea>
    <button id="btnSend">Envoyer</button>
  </div>

  <!-- Admin panel -->
  <div id="adminPanel" class="box" style="display:none;">
    <h2>üîê Panneau Admin</h2>
    <div><strong>Commentaires (mod√©ration)</strong></div>
    <div id="adminComments" style="margin-top:10px;"></div>

    <hr style="margin:12px 0;border-color:rgba(255,255,255,0.06)">

    <h3>üì¢ Publier une annonce</h3>
    <input id="annTitre" placeholder="Titre de l'annonce">
    <textarea id="annTexte" rows="3" placeholder="Message public..."></textarea>
    <input id="annDur" type="number" placeholder="Dur√©e en secondes (ex: 60)">
    <button id="btnPublishAnn">Publier l'annonce</button>

    <hr style="margin:12px 0;border-color:rgba(255,255,255,0.06)">
    <div id="adminVisitor">Joueurs en ligne : ...</div>
  </div>

</div>

<div id="brainrot-emoji" title="Menu admin secret">üß†</div>

<!-- FIREBASE + SCRIPT -->
<script type="module">
/* ---------------- IMPORTS FIREBASE ---------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

/* ---------------- FIREBASE CONFIG - remplace si besoin ---------------- */
const firebaseConfig = {
  apiKey: "AIzaSyAAc2r6FQw66MrkUNmfEhw_RQq2gqJmb_o",
  authDomain: "stealthebrainrot-fortnite.firebaseapp.com",
  projectId: "stealthebrainrot-fortnite",
  storageBucket: "stealthebrainrot-fortnite.firebasestorage.app",
  messagingSenderId: "1027380486749",
  appId: "1:1027380486749:web:da177abdbbd569947fa3b4",
  measurementId: "G-6L2XGK4282"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ---------------- UTIL ---------------- */
const escapeHtml = str => {
  if(!str) return '';
  return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;');
};

/* ---------------- SELECTEURS ---------------- */
const commentsList = document.getElementById('commentsList');
const adminComments = document.getElementById('adminComments');
const btnSend = document.getElementById('btnSend');
const inputUser = document.getElementById('inputUser');
const inputMsg = document.getElementById('inputMsg');
const adminPanel = document.getElementById('adminPanel');
const annonceBanner = document.getElementById('annonceBanner');
const annTitleBanner = document.getElementById('annTitleBanner');
const annMsgBanner = document.getElementById('annMsgBanner');
const annoncesHistory = document.getElementById('annoncesHistory');
const btnPublishAnn = document.getElementById('btnPublishAnn');
const annTitre = document.getElementById('annTitre');
const annTexte = document.getElementById('annTexte');
const annDur = document.getElementById('annDur');
const adminVisitor = document.getElementById('adminVisitor');
const visitorCountEl = document.getElementById('visitorCount');

let isAdmin = false;
let currentAnnTimer = null;

/* ---------------- COLLECTIONS & REAL-TIME ---------------- */
const commentsCol = collection(db, 'commentaires'); // collection "commentaires"
const annoncesCol = collection(db, 'annonces');     // collection "annonces"

/* Real-time comments : affichage public + admin (onSnapshot) */
const qComments = query(commentsCol, orderBy('ts', 'asc'));
onSnapshot(qComments, snapshot => {
  commentsList.innerHTML = '';
  adminComments.innerHTML = '';
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const id = docSnap.id;
    // public view
    const div = document.createElement('div');
    div.className = 'comment';
    div.innerHTML = `<strong>${escapeHtml(data.user)}</strong> : ${escapeHtml(data.msg)}`;
    commentsList.appendChild(div);

    // admin view (with delete)
    const aDiv = document.createElement('div');
    aDiv.className = 'comment';
    aDiv.innerHTML = `<strong>${escapeHtml(data.user)}</strong> : ${escapeHtml(data.msg)}`;
    if(isAdmin){
      const del = document.createElement('button');
      del.className = 'delete-btn';
      del.textContent = 'Supprimer';
      del.onclick = async () => {
        if(confirm('Supprimer ce commentaire ?')) {
          await deleteDoc(doc(db, 'commentaires', id));
        }
      };
      aDiv.appendChild(del);
    }
    adminComments.appendChild(aDiv);
  });
});

/* Real-time annonces */
const qAnns = query(annoncesCol, orderBy('ts','asc'));
onSnapshot(qAnns, snapshot => {
  const anns = [];
  snapshot.forEach(snap => anns.push({ id: snap.id, ...snap.data() }));
  // history
  annoncesHistory.innerHTML = '<h3>Historique des annonces</h3>';
  anns.slice().reverse().forEach(a => {
    const box = document.createElement('div');
    box.className = 'annonce';
    box.innerHTML = `<strong>Admin ‚Äî ${escapeHtml(a.titre)}</strong><br>${escapeHtml(a.msg)}`;
    if(isAdmin){
      const del = document.createElement('button');
      del.className = 'delete-btn';
      del.textContent = 'Supprimer';
      del.onclick = async ()=> {
        if(confirm('Supprimer l\'annonce ?')) await deleteDoc(doc(db,'annonces',a.id));
      };
      box.appendChild(del);
    }
    annoncesHistory.appendChild(box);
  });

  // last announcement banner with countdown
  if(anns.length>0){
    const last = anns[anns.length-1];
    annTitleBanner.textContent = last.titre;
    let remaining = (last.duration && Number(last.duration)) || 0;
    clearInterval(currentAnnTimer);
    annonceBanner.style.display = 'block';
    function tick(){
      if(remaining>0){
        annMsgBanner.textContent = `${last.msg} ‚Äî Temps restant : ${formatTime(remaining)}`;
        remaining--;
      } else {
        annMsgBanner.textContent = last.msg;
        clearInterval(currentAnnTimer);
        if(last.duration && Number(last.duration)>0) annonceBanner.style.display = 'none';
      }
    }
    tick();
    if(remaining>0) currentAnnTimer = setInterval(tick,1000);
  } else {
    annonceBanner.style.display = 'none';
    annTitleBanner.textContent = '';
    annMsgBanner.textContent = '';
  }
});

/* ---------------- ENVOI COMMENTAIRE ---------------- */
btnSend.addEventListener('click', async ()=>{
  const user = inputUser.value.trim();
  const msg = inputMsg.value.trim();
  if(!user || !msg){ alert('Remplis pseudo et message !'); return; }
  btnSend.disabled = true;
  try{
    await addDoc(commentsCol, { user, msg, ts: Date.now() });
    inputUser.value=''; inputMsg.value='';
  }catch(e){
    console.error(e); alert('Erreur lors de l\'envoi.');
  }
  btnSend.disabled = false;
});

/* ---------------- PUBLIER ANNONCE (admin) ---------------- */
btnPublishAnn.addEventListener('click', async ()=>{
  if(!isAdmin){ alert('Acc√®s admin requis'); return; }
  const titre = annTitre.value.trim(); const msg = annTexte.value.trim();
  const duration = parseInt(annDur.value) || 0;
  if(!titre || !msg){ alert('Titre et message obligatoires'); return; }
  try{
    await addDoc(annoncesCol, { titre, msg, duration, ts: Date.now() });
    annTitre.value=''; annTexte.value=''; annDur.value='';
  }catch(e){ console.error(e); alert('Erreur publication'); }
});

/* ---------------- ADMIN + VISITEURS ---------------- */
const brain = document.getElementById('brainrot-emoji');
brain.addEventListener('click', async ()=>{
  const code = prompt('Code admin :');
  if(code === '2711'){
    isAdmin = true;
    adminPanel.style.display = 'block';
    // update admin visitor text
    adminVisitor.innerText = visitorCountEl.innerText;
  } else alert('Code incorrect !');
});
// Ctrl + A ouvre aussi admin
document.addEventListener('keydown', (e)=>{ if(e.ctrlKey && e.key.toLowerCase()==='a'){ brain.click(); } });

/* ---------------- VISITEUR +1 (CountAPI) - visible admin ---------------- */
let lastCount = 0;
function formatTime(s){ const h=Math.floor(s/3600), m=Math.floor((s%3600)/60), sec=s%60; return `${h>0?h+'h ':''}${m>0?m+'m ':''}${sec}s`; }

async function fetchVisitor(){
  try{
    const res = await fetch('https://api.countapi.xyz/hit/stealthebrainrot/visits');
    const j = await res.json();
    const v = j.value || 0;
    if(v > lastCount && isAdmin){
      alert('+1 visiteur !');
    }
    lastCount = v;
    visitorCountEl.innerText = `Joueurs actuellement sur la map : ${v}`;
    if(isAdmin) adminVisitor.innerText = `Joueurs en ligne : ${v}`;
  }catch(e){
    visitorCountEl.innerText = 'Erreur compteur';
  }
}
// initial and poll
fetchVisitor();
setInterval(fetchVisitor,10000);

/* ---------------- FIN ---------------- */
</script>
</body>
</html>
