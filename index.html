<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Steal the Brainrot - Fortnite</title>
<style>
body{
  margin:0; padding:0; font-family:Arial,sans-serif;
  background-image: url('TON_IMAGE_DE_FOND_URL_ICI');
  background-size: cover; background-position:center; background-attachment:fixed;
  color:#fff;
}
.content{
  background-color: rgba(10,10,25,0.85);
  min-height:100vh; padding:25px; box-sizing:border-box;
}
h1,h2{color:#00ffff;}
.annonce-banner{
  display:none; background:red; color:#fff; font-size:1.4rem;
  padding:18px; border-radius:8px; margin-bottom:16px; text-align:center;
}
.annonce-banner h3{margin:0; font-size:1.6rem;}
.annonce-banner p{margin:0; font-size:1.1rem;}
.comment-section, .code-container, .map-status, #adminLogin{
  background: rgba(30,30,50,0.9); border:2px solid #00ffff; padding:20px; border-radius:12px; margin:20px 0;
}
input, textarea, button{width:100%; padding:10px; margin-top:5px; border-radius:8px; border:none;}
button{background:#00ffff; color:#000; font-weight:bold; cursor:pointer;}
.delete-btn{background:#ff4444;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;margin-top:5px;}
.comment{background: rgba(255,255,255,0.1); padding:10px; border-radius:8px; margin-bottom:10px;}
#brainrot-emoji{
  position: fixed;
  bottom: 20px;
  right: 20px;
  font-size: 36px;
  cursor: pointer;
  padding: 10px;
  background: rgba(0,0,0,0.3);
  border-radius: 50%;
  z-index: 9999;
}
#brainrot-emoji:hover{transform:scale(1.2);}
.annonce {background-color: rgba(255,0,0,0.1); padding:10px; margin-bottom:10px; border-left:4px solid red;}
</style>
</head>
<body>
<div class="content">
  <h1>Steal the Brainrot - Fortnite</h1>

  <!-- BANNIERE D'ANNONCE -->
  <div id="annonceBanner" class="annonce-banner">
    <h3 id="annonceBannerTitle"></h3>
    <p id="annonceBannerMsg"></p>
  </div>

  <!-- HISTORIQUE ANNONCES -->
  <div id="annoncesDiv"></div>

  <p>Fortnite ne se limite plus √† son Battle Royale classique. La carte <strong>Steal the Brainrot</strong> rencontre un immense succ√®s.</p>

  <h2>üë• Joueurs en ligne</h2>
  <p id="visitorCount">Chargement...</p>

  <h2>üíª Comment utiliser les codes ?</h2>
  <p>Allez au terminal num√©rique ou √† c√¥t√© de la roue Galaxy Spin. Tapez le code et validez-le.</p>

  <h2>üìú Codes Utilisables</h2>
  <div class="code-container">
    <p>(NEW) 651312 ‚Üí Fait appara√Ætre un Ferinsini Luckini</p>
    <p>(NEW) 410592 ‚Üí Brainrot Secret dans la machine d'am√©lioration</p>
    <p>(NEW) 3428 ‚Üí Passe le temps de la machine d'am√©lioration</p>
    <p>536736 ‚Üí Brainrot Secret dans la machine d'am√©lioration</p>
    <p>3851 ‚Üí Passe le temps de la machine d'am√©lioration</p>
    <p>1003 ‚Üí Passe le temps de la machine d'am√©lioration</p>
    <p>1706 ‚Üí D√©bloque un Brainrot God Lucky Rot</p>
    <p>8257 ‚Üí Lucky Rot Brainrot God</p>
    <p>5269 ‚Üí Fait appara√Ætre un Brainrot God</p>
  </div>

  <h2>üìú Codes Expir√©s</h2>
  <div class="code-container">
    <p>526497, 9586, 2553, 7389, 9452, 1442, 9231, 6393, 3632, 3005, 9207676, 2388, 7346, 1825, 1912, 5289, 1507, 0108, 3000, 9547, 6759</p>
    <p>Si un code ne fonctionne plus, c‚Äôest normal, il a √©t√© supprim√©.</p>
  </div>

  <h2>üó∫Ô∏è √âtat de la map</h2>
  <div class="map-status">
    <p>Zone centrale : Terminal num√©rique et roue Galaxy Spin</p>
    <p>Zone Brainrot : Brainrots normaux apparaissent toutes les 5 minutes</p>
    <p>Zone machine d‚Äôam√©lioration : Machine fonctionnelle, peut √™tre acc√©l√©r√©e avec les codes</p>
    <p>Zone Ferinsini Luckini : Zone rare avec Brainrots sp√©ciaux</p>
  </div>

  <h2>üí¨ Commentaires des joueurs</h2>
  <div class="comment-section">
    <div id="comments"></div>
    <input id="username" placeholder="Ton pseudo">
    <textarea id="message" placeholder="Ton message..."></textarea>
    <button id="sendCommentBtn">Envoyer</button>
  </div>

  <!-- ADMIN -->
  <div id="adminLogin" style="display:none;" class="comment-section">
    <h3>üîê Espace Admin</h3>
    <div id="adminComments"></div>

    <h3>üì¢ Cr√©er une annonce</h3>
    <input id="annTitle" placeholder="Titre de l'annonce">
    <textarea id="annMsg" placeholder="Message de l'annonce"></textarea>
    <input id="annCountdown" type="number" placeholder="Dur√©e en secondes">
    <button id="publishAnnonce">Publier annonce</button>

    <h3>üìù Notes Admin (priv√©es)</h3>
    <div id="adminNotes"></div>
    <textarea id="newNote" placeholder="√âcrire une note priv√©e..."></textarea>
    <button id="addNoteBtn">Ajouter la note</button>
  </div>
</div>

<div id="brainrot-emoji" title="Menu admin secret">üß†</div>

<script type="module">
// ---------------- FIREBASE INIT ----------------
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAAc2r6FQw66MrkUNmfEhw_RQq2gqJmb_o",
  authDomain: "stealthebrainrot-fortnite.firebaseapp.com",
  projectId: "stealthebrainrot-fortnite",
  storageBucket: "stealthebrainrot-fortnite.firebasestorage.app",
  messagingSenderId: "1027380486749",
  appId: "1:1027380486749:web:da177abdbbd569947fa3b4",
  measurementId: "G-6L2XGK4282"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ---------------- COMMENTAIRES PUBLICS ----------------
const commentsCol = collection(db,'public_comments');
const commentsDiv = document.getElementById('comments');
const sendBtn = document.getElementById('sendCommentBtn');
const usernameInput = document.getElementById('username');
const messageInput = document.getElementById('message');

function escapeHtml(str){return str.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;');}

onSnapshot(query(commentsCol, orderBy('ts','asc')), snapshot=>{
  commentsDiv.innerHTML='';
  snapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const div = document.createElement('div'); div.className='comment';
    div.innerHTML=`<strong>${escapeHtml(data.user)}</strong> : ${escapeHtml(data.msg)}`;
    commentsDiv.appendChild(div);
  });
});

sendBtn.addEventListener('click', async ()=>{
  const user = usernameInput.value.trim();
  const msg = messageInput.value.trim();
  if(!user || !msg){alert('Remplis pseudo et message !'); return;}
  await addDoc(commentsCol,{user,msg,ts:Date.now()});
  usernameInput.value=''; messageInput.value='';
});

// ---------------- ADMIN ----------------
const brainrot = document.getElementById('brainrot-emoji');
const adminDiv = document.getElementById('adminLogin');
let isAdmin=false;

function openAdmin(){
  const code = prompt("Code admin :");
  if(code==='2711'){ isAdmin=true; adminDiv.style.display='block'; loadAdminNotes(); renderAnnonces(); showVisitorCount(); }
  else alert('Code incorrect !');
}
brainrot.addEventListener('click', openAdmin);
document.addEventListener('keydown', (e)=>{if(e.key==='a' && e.ctrlKey) openAdmin();});

// ---------------- ANNONCES ----------------
const annDiv = document.getElementById('annoncesDiv');
const banner = document.getElementById('annonceBanner');
const titleEl = document.getElementById('annonceBannerTitle');
const msgEl = document.getElementById('annonceBannerMsg');
let annTimer;

const KEY_ANN = 'annonces_v2';
let annonces = JSON.parse(localStorage.getItem(KEY_ANN)||'[]');

function renderAnnonces(){
  if(annonces.length===0){banner.style.display='none'; annDiv.innerHTML=''; return;}
  const last = annonces[annonces.length-1];
  banner.style.display='block'; titleEl.textContent=last.titre;
  let remaining = last.countdown||0; clearInterval(annTimer);
  function updateBanner(){
    if(remaining>0){ msgEl.textContent=`${last.msg} | Temps restant : ${formatTime(remaining)}`; remaining--; }
    else { msgEl.textContent=last.msg; clearInterval(annTimer); banner.style.display='none'; }
  }
  updateBanner();
  if(remaining>0) annTimer=setInterval(updateBanner,1000);

  annDiv.innerHTML='<h3>Historique des annonces</h3>';
  annonces.slice().reverse().forEach((a,idx)=>{
    const box=document.createElement('div'); box.className='annonce';
    box.innerHTML=`<strong>Admin ‚Äî ${a.titre}</strong><br>${a.msg}`;
    if(isAdmin){
      const del=document.createElement('button'); del.className='delete-btn'; del.textContent='Supprimer';
      del.onclick=()=>{annonces.splice(annonces.length-1-idx,1); localStorage.setItem(KEY_ANN,JSON.stringify(annonces)); renderAnnonces();}
      box.appendChild(del);
    }
    annDiv.appendChild(box);
  });
}

document.getElementById('publishAnnonce').addEventListener('click',()=>{
  const t=document.getElementById('annTitle').value.trim();
  const m=document.getElementById('annMsg').value.trim();
  let c=parseInt(document.getElementById('annCountdown').value);
  if(!t||!m){alert('Titre et message obligatoires'); return;}
  if(isNaN(c)||c<0) c=0;
  annonces.push({titre:t,msg:m,countdown:c});
  localStorage.setItem(KEY_ANN,JSON.stringify(annonces));
  document.getElementById('annTitle').value='';
  document.getElementById('annMsg').value='';
  document.getElementById('annCountdown').value='';
  renderAnnonces();
});

function formatTime(s){ const h=Math.floor(s/3600); const m=Math.floor((s%3600)/60); const sec=s%60; return `${h>0?h+'h ':''}${m>0?m+'m ':''}${sec}s`; }

// ---------------- NOTES ADMIN ----------------
const adminNotesCol = collection(db,'admin_notes');
const adminNotesDiv = document.getElementById('adminNotes');
const addNoteBtn = document.getElementById('addNoteBtn');
const newNoteInput = document.getElementById('newNote');

function loadAdminNotes(){
  const qNotes = query(adminNotesCol, orderBy('ts','asc'));
  onSnapshot(qNotes, snapshot=>{
    adminNotesDiv.innerHTML='';
    snapshot.forEach(docSnap=>{
      const data = docSnap.data(); const id = docSnap.id;
      if(isAdmin){
        const div = document.createElement('div'); div.className='comment';
        div.innerHTML = escapeHtml(data.text);
        const del = document.createElement('button');
        del

